(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,t,n){n("NyhP"),e.exports=n("ftlp")},"002B":function(e,t,n){},ftlp:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),o=n.n(r),a=(n("55Ip"),n("Ty5D"),n("i8i4")),i=(n("dE+T"),n("YJVH"),n("bHtr"),n("0l/t"),n("dRSK"),n("INYr"),n("6VaU"),n("8+KV"),n("HEwt"),n("Z2Ku"),n("V+eJ"),n("LK8F"),n("yt8O"),n("mGWK"),n("bWfx"),n("6AQ9"),n("DNiP"),n("SPin"),n("dZ+Y"),n("Vd3H"),n("0E+W"),n("eM6i"),n("jqX0"),n("AphP"),n("yM4b"),n("h7Nl"),n("2Spj"),n("IXt9"),n("f3/d"),n("9AAn"),n("fyVe"),n("U2t9"),n("2atp"),n("+auO"),n("MtdB"),n("Jcmo"),n("nzyx"),n("BC7C"),n("x8ZO"),n("9P93"),n("BJ/l"),n("eHKK"),n("pp/T"),n("CyHz"),n("bBoP"),n("x8Yj"),n("hLT2"),n("xfY5"),n("Ljet"),n("/KAi"),n("fN96"),n("7h0T"),n("sbF8"),n("h/M4"),n("knhD"),n("XfKG"),n("BP8U"),n("91GP"),n("hHhE"),n("RQRG"),n("/uf1"),n("HAE/"),n("WLL4"),n("/8Fb"),n("DW2E"),n("mYba"),n("jm62"),n("JduL"),n("5Pf0"),n("uaHG"),n("ZNX/"),n("mura"),n("Btvt"),n("25dN"),n("Zshi"),n("V/DX"),n("FlsD"),n("RW0V"),n("z2o2"),n("/SS/"),n("hhXQ"),n("VRzm"),n("CX2u"),n("3xty"),n("I5cv"),n("iMoV"),n("uhZd"),n("0YWM"),n("694e"),n("LTTk"),n("9rMk"),n("IlFx"),n("xpiv"),n("oZ/O"),n("klPD"),n("knU9"),n("Oyvg"),n("OEbY"),n("SRfc"),n("pIFo"),n("KKXr"),n("OG14"),n("a1Th"),n("T39b"),n("ioFf"),n("rE2o"),n("hEkN"),n("nIY7"),n("+oPb"),n("SMB2"),n("oDIu"),n("rvZc"),n("0mN4"),n("bDcW"),n("nsiH"),n("VpUO"),n("L9s1"),n("0LDn"),n("XfO3"),n("tUrg"),n("9XZr"),n("7VC1"),n("eI33"),n("FLlr"),n("84bF"),n("9VmF"),n("FEjr"),n("Zz4T"),n("JCqj"),n("Tze0"),n("I74W"),n("fA63"),n("xm80"),n("Ji/l"),n("sFw1"),n("NO8f"),n("aqI/"),n("Faw5"),n("r1bV"),n("tuSo"),n("nCnK"),n("Y9lz"),n("Tdpu"),n("EK0E"),n("wCsR"),n("R5XZ"),n("Ew+T"),n("rGqo"),n("ls82"),n("qKs0"),n("VXxg"),n("DpIS"),n("bZMm"),n("cr+I")),u=n("1OyB"),c=n("vuIU"),s=n("md7G"),l=n("foSv"),d=n("Ji7U"),f=n("17x9"),p=n.n(f),m=n("i7EJ"),h=n("K4CH"),v=n.n(h),b=function(e){return fetch("".concat("https://lens.zhihu.com","/").concat(e),{headers:{"X-Referer":document.referrer,"Content-Type":"application/json","X-App-Za.OS":"webplayer"},credentials:"include"})},E=n("vN+2"),y=n.n(E),w={PLAY_FAILED:"playfailed",PLAY_COUNT:"playcount",PLAY_BUFFERING:"playbuffering",BUFFERING_TIME:"bufferingtime",FIRST_FRAME_TIME:"firstframetime"},g=v()(navigator.userAgent);function O(e){var t=e.msg,n=e.id,r=e.time,o=void 0===r?0:r,a=e.quality,u=e.detail,c=void 0===u?"":u,s=e.f,l=e.bu,d=e.v,f=e.platform;if(n){var p=Object(i.stringify)({type:"msg",msg:t,time:o,videoid:n,playtype:"inline",quality:a,platform:f,version:"1.0.0",f:s,bu:l,v:d,timestamp:Date.now(),dummy:Math.random(),btype:g.browser.name,bversion:g.browser.version,ostype:g.os.name,osversion:g.os.version,detail:c});b("report?".concat(p)).catch(y.a)}}var S=function(e){return b(e).then(function(e){return e.json()}).then(function(e){if(e.error){var t=new Error;throw t.payload=e.error,t}return e})},j=function(e){return e?function(e){return S("api/v4/videos/".concat(e))}(e).catch(function(t){throw O({msg:"playfailed",videoId:e,detail:"fetch-videoinfo-failure"}),t}):Promise.reject()},P=900;var T=n("/7Jz"),F=T.a.create({coverConverting:{position:"absolute",overflow:"hidden",top:"50%",transform:"translateY(-50%)",width:"100%",height:"100%"},coverBlurImage:{width:"100%",filter:"blur(8px)",transform:"scale(1.1)"},coverBlurTip:{position:"absolute","z-index":"1",top:"50%",left:"50%",color:"#fff",transform:"translate(-50%, -50%)"}}),R=function(e){var t=e.thumbnail,n=e.msg;return o.a.createElement("div",{className:Object(T.b)(F.coverConverting)},t&&o.a.createElement("img",{className:Object(T.b)(F.coverBlurImage),src:t}),o.a.createElement("div",{className:Object(T.b)(F.coverBlurTip)},n))},I=T.a.create({errorCover:{position:"absolute",overflow:"hidden",top:0,bottom:0,left:0,right:0,background:"#EBEBEB"},coverTip:{position:"absolute","z-index":"1",top:"50%",left:"50%",color:"#BFBFBF",transform:"translate(-50%, -50%)","white-space":"nowrap"}}),L=function(e){var t=e.msg;return o.a.createElement("div",{className:Object(T.b)(I.errorCover)},o.a.createElement("div",{className:Object(T.b)(I.coverTip)},t))},A=n("jcei"),B=function(){function e(t){var n=t.onStart,r=void 0===n?y.a:n,o=t.onStop,a=void 0===o?y.a:o;Object(u.a)(this,e),this._onStart=r,this._onStop=a,this._startTime=0}return Object(c.a)(e,[{key:"start",value:function(e){this.isRunning()||(this._startTime=Date.now(),this._onStart(this._startTime,e))}},{key:"reset",value:function(){this._startTime=0}},{key:"stop",value:function(e){if(this.isRunning()){var t=Date.now()-this._startTime;this._onStop(t,e),this.reset()}}},{key:"isRunning",value:function(){return this._startTime>0}}]),e}(),N=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).firstFrameStopwatch=new B({onStart:function(){return n.sendReport(w.PLAY_COUNT)},onStop:function(e){return n.sendReport(w.FIRST_FRAME_TIME,e)}}),n.bufferStopwatch=new B({onStop:function(e,t){e>100&&(n.sendReport(w.PLAY_BUFFERING,1e3*t),n.sendReport(w.BUFFERING_TIME,e))}}),n.eventSubscriptions=[],n.allowReportPlayfailed=!1,n.handleWaiting=function(){n.firstFrameStopwatch.isRunning()||n.bufferStopwatch.start()},n.handlePlaying=function(e){n.firstFrameStopwatch.stop(),n.bufferStopwatch.stop(e.currentTime)},n.sendReport=function(e,t){if(e===w.PLAY_FAILED){if(!n.allowReportPlayfailed)return;n.allowReportPlayfailed=!1}else e===w.PLAY_COUNT&&(n.allowReportPlayfailed=!0);n.props.sendReport(e,t)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.subscribeEvent;this.eventSubscriptions=[t(A.b.PLAYER.PLAY_COUNT,function(){e.firstFrameStopwatch.start()}),t(A.b.PLAYER.PLAY_FAILED,function(t){var n=t.currentTime;e.sendReport(w.PLAY_FAILED,n)}),t(A.b.DOM.WAITING,this.handleWaiting),t(A.b.DOM.PLAYING,this.handlePlaying)]}},{key:"componentWillUnmount",value:function(){this.eventSubscriptions.forEach(function(e){return(0,e.unsubscribe)()})}},{key:"render",value:function(){return null}}]),t}(o.a.PureComponent),_=function(e){var t=e.id,n=e.useMSE;return o.a.createElement(m.b.Consumer,null,function(e){var r=e.subscribeEvent;return o.a.createElement(m.c.Consumer,null,function(e){var a=e.currentQuality,u=e.currentSrc;return o.a.createElement(N,{key:t,subscribeEvent:r,sendReport:function(e,t,n,r){if(!e||!t||!n)return y.a;var o=Object(i.parse)(n),a=o.v,u=o.bu,c=o.f,s=r?"webmse":"web";return function(n,r){return O({msg:n,id:e,time:r,quality:t,v:a,bu:u,f:c,platform:s})}}(t,a,u,n)})})})},M=n("ODXe"),C=T.a.create({logo:{width:"40%",position:"absolute",top:"3%",right:"4%"}}),D="https://pic1.zhimg.com/80/v2-fa2fe8f24dcd80279239ede81144c23a_hd.png";function Y(){return function(){var e=Object(r.useContext)(m.b).subscribeEvent,t=Object(r.useState)(!1),n=Object(M.a)(t,2),o=n[0],a=n[1];return Object(r.useEffect)(function(){if(Object(i.parse)(location.search).vzuu)return e(A.b.PLAYER.PLAY_COUNT,function(){a(!0)}).unsubscribe},[]),o}()&&o.a.createElement(m.a,null,o.a.createElement("img",{className:Object(T.b)(C.logo),src:D}))}var k=["ld","sd","hd"];var U=n("UMpK"),z=n.n(U);var x=v()(navigator.userAgent),K=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(o)))).state={hasError:!1,error:null,data:null,id:null},n.load=function(){var e=n.props.id;return/^\d+$/.test(e)?j(e).then(function(e){return n.setState({data:e})}).catch(function(e){n.setState({hasError:!0,error:e.payload||null})}):(n.setState({hasError:!0,error:null}),Promise.reject())},n.onBeforePlay=function(e){return e?function(e){var t=Object(i.parse)(e).expiration,n=Date.now()/1e3;return t&&Number(t)<n+P}(e)?n.load():Promise.resolve():Promise.reject()},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.id&&this.load()}},{key:"componentDidUpdate",value:function(e){this.props.id!==e.id&&this.props.id&&this.load()}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.useMSE,r=this.state,a=r.data,i=r.hasError,u=r.error;if(i&&u)return o.a.createElement(L,{msg:u.message||"\u89c6\u9891\u52a0\u8f7d\u5931\u8d25"});if(!a)return null;var c,s=a.title,l=a.cover_url,d=a.thumbnail,f=a.isConverting,p=(c=a.playlist,z()(c,function(e,t,n){e[n.toLowerCase()]=t})),h=x.browser,v=h.major,b=h.name,E=x.os.name,y=n&&"Chrome"===b&&v>=49&&"Android"!==E&&"iOS"!==E,w=function(e){var t=k.find(function(t){return Boolean(e[t])});return t?e[t]:null}(p)||{},g=w.duration,O=void 0===g?0:g,S=w.width,j=void 0===S?0:S,P=w.height,T=void 0===P?0:P;return f?o.a.createElement(R,{thumbnail:d,msg:"\u89c6\u9891\u6b63\u5728\u8f6c\u7801\u4e2d..."}):o.a.createElement(m.d,{standalone:!0,id:t,title:s,error:i?u||{message:"\u89c6\u9891\u5df2\u88ab\u5220\u9664"}:null,cover:l,duration:O,sources:p,onBeforePlay:this.onBeforePlay,videoHeight:T,videoWidth:j,useMSE:y,locale:"zh-Hans",observeResize:!0},o.a.createElement(_,{id:t,useMSE:n}),o.a.createElement(Y,null))}}]),t}(r.Component);K.propTypes={id:p.a.string},K.defaultProps={id:null},K.getDerivedStateFromProps=function(e,t){return e.id!==t.id&&e.id?{hasError:!1,error:null,data:null,id:e.id}:null};var V=K;n("002B");function X(){return window.parent===window||/^https?:\/\/[^/]+\.(?:zhihu\.com|zhihu\.test|vzuu\.com|candystars\.net|cntestdemo\.com)(?::\d+)?(?:\/|$)/.test(document.referrer)||/^https?:\/\/\d+\.\d+\.\d+\.\d+(?::\d+)?(?:\/|$)/.test(document.referrer)&&Object(i.parse)(location.search.replace("?","")).vzuu}var G=!0;function W(){if(X()){var e=(n=location.pathname.match(/^\/video\/(\d+)$/))&&n[1]?n[1]:null,t=Object(i.parse)(location.search).useMSE;if(!G)return o.a.createElement(V,{id:e,useMSE:t});Object(a.render)(o.a.createElement(V,{id:e,useMSE:t}),document.getElementById("player"))}var n}W(),document.body.addEventListener("click",function(){}),document.body.addEventListener("touchstart",function(){}),document.body.addEventListener("touchend",function(){}),document.body.addEventListener("click",function(){},{capture:!0}),document.body.addEventListener("touchstart",function(){},{capture:!0}),document.body.addEventListener("touchend",function(){},{capture:!0})}},[[0,2,1]]]);
//# sourceMappingURL=client.7a06cffd.chunk.js.map