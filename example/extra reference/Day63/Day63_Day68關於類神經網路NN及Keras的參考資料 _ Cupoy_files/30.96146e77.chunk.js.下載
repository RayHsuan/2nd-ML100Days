webpackJsonp([30],{1381:function(e,n,t){(function(n){var t,i=n.crypto||n.msCrypto;if(i&&i.getRandomValues){var a=new Uint8Array(16);t=function(){return i.getRandomValues(a),a}}if(!t){var r=new Array(16);t=function(){for(var e,n=0;n<16;n++)0===(3&n)&&(e=4294967296*Math.random()),r[n]=e>>>((3&n)<<3)&255;return r}}e.exports=t}).call(n,t(37))},1382:function(e,n){function t(e,n){var t=n||0,a=i;return a[e[t++]]+a[e[t++]]+a[e[t++]]+a[e[t++]]+"-"+a[e[t++]]+a[e[t++]]+"-"+a[e[t++]]+a[e[t++]]+"-"+a[e[t++]]+a[e[t++]]+"-"+a[e[t++]]+a[e[t++]]+a[e[t++]]+a[e[t++]]+a[e[t++]]+a[e[t++]]}for(var i=[],a=0;a<256;++a)i[a]=(a+256).toString(16).substr(1);e.exports=t},1409:function(e,n,t){var i=t(1410),a=t(1411),r=a;r.v1=i,r.v4=a,e.exports=r},1410:function(e,n,t){function i(e,n,t){var i=n&&t||0,a=n||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:u,p=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:c+1,m=p-s+(d-c)/1e4;if(m<0&&void 0===e.clockseq&&(o=o+1&16383),(m<0||p>s)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,c=d,u=o,p+=122192928e5;var g=(1e4*(268435455&p)+d)%4294967296;a[i++]=g>>>24&255,a[i++]=g>>>16&255,a[i++]=g>>>8&255,a[i++]=255&g;var f=p/4294967296*1e4&268435455;a[i++]=f>>>8&255,a[i++]=255&f,a[i++]=f>>>24&15|16,a[i++]=f>>>16&255,a[i++]=o>>>8|128,a[i++]=255&o;for(var h=e.node||l,b=0;b<6;++b)a[i+b]=h[b];return n||r(a)}var a=t(1381),r=t(1382),o=a(),l=[1|o[0],o[1],o[2],o[3],o[4],o[5]],u=16383&(o[6]<<8|o[7]),s=0,c=0;e.exports=i},1411:function(e,n,t){function i(e,n,t){var i=n&&t||0;"string"==typeof e&&(n="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||a)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n)for(var l=0;l<16;++l)n[i+l]=o[l];return n||r(o)}var a=t(1381),r=t(1382);e.exports=i},853:function(e,n,t){"use strict";function i(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!==typeof n&&"function"!==typeof n?e:n}function l(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function u(e,n){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}Object.defineProperty(n,"__esModule",{value:!0});var s=t(1),c=t.n(s),p=t(32),d=t(48),m=t(54),g=t(5),f=t(316),h=t(1409),b=t.n(h),x=t(8),v=t(26),A=t(119),y=t(293),E=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),k=u(["\n    display: flex;\n    height: ","px;\n    padding: 0 20px 0 30px;\n    align-items: center;\n"],["\n    display: flex;\n    height: ","px;\n    padding: 0 20px 0 30px;\n    align-items: center;\n"]),C=u(["\n    display: inline-block;\n    height: 36px;\n    margin: 0 20px 0 0;\n    padding: 0;\n    border: 1px solid transparent;\n    color: ",";\n    font-size: 24px;\n    flex: 1;\n\n    ","\n"],["\n    display: inline-block;\n    height: 36px;\n    margin: 0 20px 0 0;\n    padding: 0;\n    border: 1px solid transparent;\n    color: ",";\n    font-size: 24px;\n    flex: 1;\n\n    ","\n"]),D=u(["\n    display: inline-flex;\n    margin: 0 0 0 auto;\n"],["\n    display: inline-flex;\n    margin: 0 0 0 auto;\n"]),Q=u(["\n    position: relative;\n    display: inline-block;\n    width: 160px;\n    height: 36px;\n    line-height: 36px;\n    margin: 0 0 0 12px;\n    padding: 0;\n    font-weight: 600;\n    color: #fff;\n    font-size: 14px;\n"],["\n    position: relative;\n    display: inline-block;\n    width: 160px;\n    height: 36px;\n    line-height: 36px;\n    margin: 0 0 0 12px;\n    padding: 0;\n    font-weight: 600;\n    color: #fff;\n    font-size: 14px;\n"]),O=u(["\n    height: 36px;\n    line-height: 36px;\n    margin: 0;\n    padding: 0 24px;\n    border: none;\n    font-weight: 600;\n    background-color: ",";\n    color: #fff;\n    font-size: 14px;\n\n    &:hover {\n        background-color: ",";\n        color: #fff;\n    }\n"],["\n    height: 36px;\n    line-height: 36px;\n    margin: 0;\n    padding: 0 24px;\n    border: none;\n    font-weight: 600;\n    background-color: ",";\n    color: #fff;\n    font-size: 14px;\n\n    &:hover {\n        background-color: ",";\n        color: #fff;\n    }\n"]),U=u(["\n    position: relative;\n    width: 100%;\n    height: calc(100% - ","px);\n    padding: 20px;\n    border: none;\n    background-color: #EEEEEE;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    box-shadow: 0px -1px 0px 0px #CCCCCC;\n\n    ","\n"],["\n    position: relative;\n    width: 100%;\n    height: calc(100% - ","px);\n    padding: 20px;\n    border: none;\n    background-color: #EEEEEE;\n    overflow-x: hidden;\n    overflow-y: scroll;\n    box-shadow: 0px -1px 0px 0px #CCCCCC;\n\n    ","\n"]),w=u(["\n    position: relative;\n    height: 100%;\n    border: 1px dashed ",";\n    border-radius: 5px;\n    background-color: #FAFAFA;\n"],["\n    position: relative;\n    height: 100%;\n    border: 1px dashed ",";\n    border-radius: 5px;\n    background-color: #FAFAFA;\n"]),F=u(["\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    text-align: center;\n    transform: translateX(-50%) translateY(-50%);\n"],["\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    text-align: center;\n    transform: translateX(-50%) translateY(-50%);\n"]),I=u(["\n    margin: 0 auto 16px auto;\n"],["\n    margin: 0 auto 16px auto;\n"]),j=u(["\n    margin: 0 0 10px 0;\n    font-weight: 600;\n    color: ",";\n    font-size: 24px;\n"],["\n    margin: 0 0 10px 0;\n    font-weight: 600;\n    color: ",";\n    font-size: 24px;\n"]),L=u(["\n    margin: 0;\n    font-weight: 600;\n    color: ",";\n    font-size: 14;\n"],["\n    margin: 0;\n    font-weight: 600;\n    color: ",";\n    font-size: 14;\n"]),M=u(["\n    display: inline-block;\n    font-weight: 600;\n    color: ",";\n    text-decoration: underline;\n    cursor: pointer;\n"],["\n    display: inline-block;\n    font-weight: 600;\n    color: ",";\n    text-decoration: underline;\n    cursor: pointer;\n"]),S=u(["\n    position: relative;\n    width: 100%;\n    min-height: 100%;\n    margin: 0 -10px -20px -10px;\n"],["\n    position: relative;\n    width: 100%;\n    min-height: 100%;\n    margin: 0 -10px -20px -10px;\n"]),z=u(["\n    display: inline-block;\n    position: relative;\n    width: calc(25% - 21px);\n    height: 350px;\n    margin: 0 10px 20px 10px;\n    border: 1px dashed ",";\n    border-radius: 3px;\n    float: left;    \n    cursor: pointer;\n\n    input {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 0;\n        height: 0;\n        opacity: 0;\n    }\n"],["\n    display: inline-block;\n    position: relative;\n    width: calc(25% - 21px);\n    height: 350px;\n    margin: 0 10px 20px 10px;\n    border: 1px dashed ",";\n    border-radius: 3px;\n    float: left;    \n    cursor: pointer;\n\n    input {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 0;\n        height: 0;\n        opacity: 0;\n    }\n"]),T=u(["\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    color: ",";\n    font-size: 32px;\n    transform: translateX(-50%) translateY(-50%);\n"],["\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    color: ",";\n    font-size: 32px;\n    transform: translateX(-50%) translateY(-50%);\n"]),P=u(["\n    position: absolute;\n    display: flex;\n    top: -10px;\n    right: -10px;\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    color: #fff;\n    font-size: 16px;\n    background-color: ",";\n    cursor: pointer;\n    opacity: 0;\n    align-items: center;\n    justify-content: center;\n    transition: opacity .3s;\n"],["\n    position: absolute;\n    display: flex;\n    top: -10px;\n    right: -10px;\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    color: #fff;\n    font-size: 16px;\n    background-color: ",";\n    cursor: pointer;\n    opacity: 0;\n    align-items: center;\n    justify-content: center;\n    transition: opacity .3s;\n"]),_=u(["\n    ","\n\n    display: inline-block;\n    position: relative;\n    width: calc(25% - 21px);\n    height: 350px;\n    margin: 0 10px 20px 10px;\n    border-radius: 3px;\n    background-color: #fff;\n    float: left;\n\n    &:hover {\n        "," {\n            opacity: 1;\n        }\n    }\n"],["\n    ","\n\n    display: inline-block;\n    position: relative;\n    width: calc(25% - 21px);\n    height: 350px;\n    margin: 0 10px 20px 10px;\n    border-radius: 3px;\n    background-color: #fff;\n    float: left;\n\n    &:hover {\n        "," {\n            opacity: 1;\n        }\n    }\n"]),R=u(["\n    position: relative;\n    height: 45%;\n    max-height: 160px;\n"],["\n    position: relative;\n    height: 45%;\n    max-height: 160px;\n"]),N=u(["\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #eee;\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: center;\n"],["\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #eee;\n    background-size: cover;\n    background-repeat: no-repeat;\n    background-position: center;\n"]),B=u(["\n    position: absolute;\n    display: flex;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ",";\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n"],["\n    position: absolute;\n    display: flex;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: ",";\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n"]),G=u(["\n    line-height: 21px;\n    margin: 0 0 4px 0;\n    color: #FFFFFF;\n    font-size: 16px;\n    letter-spacing: 0px;\n\n    ","\n"],["\n    line-height: 21px;\n    margin: 0 0 4px 0;\n    color: #FFFFFF;\n    font-size: 16px;\n    letter-spacing: 0px;\n\n    ","\n"]),Y=u(["\n    margin: 0 0 4px 0;\n    text-align: center;\n    font-size: 24px;\n"],["\n    margin: 0 0 4px 0;\n    text-align: center;\n    font-size: 24px;\n"]),X=u(["\n    position: relative;\n    width: 40%;\n    height: 4px;\n    background-color: rgba(255, 255, 255, 0.5);\n"],["\n    position: relative;\n    width: 40%;\n    height: 4px;\n    background-color: rgba(255, 255, 255, 0.5);\n"]),q=u(["\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #fff;\n\n    ","\n"],["\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #fff;\n\n    ","\n"]),H=u(["\n    height: 55%;\n    min-height: calc(100% - 160px);\n    padding: 12px;\n    background-color: #fff;\n"],["\n    height: 55%;\n    min-height: calc(100% - 160px);\n    padding: 12px;\n    background-color: #fff;\n"]),V=u(["\n    width: 100%;\n    height: 100%;\n    line-height: 21px;\n    margin: 0;\n    padding: 12px;\n    border: 1px solid #eee;\n    border-radius: 3px;\n    color: #333030;\n    font-size: 14px;\n    letter-spacing: 0px;\n"],["\n    width: 100%;\n    height: 100%;\n    line-height: 21px;\n    margin: 0;\n    padding: 12px;\n    border: 1px solid #eee;\n    border-radius: 3px;\n    color: #333030;\n    font-size: 14px;\n    letter-spacing: 0px;\n"]),J=g.default.div(k,96),W=g.default.input(C,v.e.Dark,function(e){if(e.error)return"\n                padding: 0 10px;\n                border: 1px solid "+v.e.Error+";\n            "}),K=g.default.div(D),Z=v.b.Red.extend(Q),$=v.b.Base.extend(O,v.e.Dark4,v.e.LightenDarkenColor(v.e.Dark4,10)),ee=g.default.div(U,96,function(e){if(e.empty)return"background-color: #fff;"}),ne=Object(g.default)(f.a)(w,v.e.Dark4),te=g.default.div(F),ie=g.default.img(I),ae=g.default.div(j,v.e.Dark),re=g.default.div(L,v.e.Dark4),oe=g.default.div(M,v.e.Dark),le=Object(g.default)(f.a)(S),ue=g.default.label(z,v.e.Dark4),se=g.default.div(T,v.e.Dark4),ce=g.default.div(P,v.e.Dark),pe=g.default.div(_,v.i.CardBorderStyle,ce),de=g.default.div(R),me=g.default.div(N),ge=g.default.div(B,v.e.RGBA("#333030",.5)),fe=g.default.div(G,function(e){if(e.error)return"\n                color: "+v.e.Red+";\n                font-weight: 600;\n            "}),he=g.default.div(Y),be=g.default.div(X),xe=g.default.div(q,function(e){if(e.progress)return"\n                width: "+e.progress+"%;\n            "}),ve=g.default.div(H),Ae=g.default.textarea(V),ye=function(e){function n(e){r(this,n);var t=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={title:"",isTitleEmpty:!1,isCreateError:!1},t.isCreating=!1,t.closeDialog=t.closeDialog.bind(t),t.createSubmit=t.createSubmit.bind(t),t.createCancel=t.createCancel.bind(t),t.editSubmit=t.editSubmit.bind(t),t.editCancel=t.editCancel.bind(t),t.backendUploadAlbumQueue=t.backendUploadAlbumQueue.bind(t),t.onInputChange=t.onInputChange.bind(t),t.onImageInputChange=t.onImageInputChange.bind(t),t.onFileDrop=t.onFileDrop.bind(t),t.onFileChanged=t.onFileChanged.bind(t),t.startUploadAlbumCumatrixItem=t.startUploadAlbumCumatrixItem.bind(t),t.createAlbumCumatrixItem=t.createAlbumCumatrixItem.bind(t),t.createNewAlbumQueue=t.createNewAlbumQueue.bind(t),t.addFilesToQueue=t.addFilesToQueue.bind(t),t.getAlbumQueue=t.getAlbumQueue.bind(t),t.updateAlbumQueue=t.updateAlbumQueue.bind(t),t.removeAlbumQueue=t.removeAlbumQueue.bind(t),t.getAlbumImage=t.getAlbumImage.bind(t),t.removeImage=t.removeImage.bind(t),t.checkAlbumQueue=t.checkAlbumQueue.bind(t),t.addEditImageToQueue=t.addEditImageToQueue.bind(t),t}return l(n,e),E(n,[{key:"componentDidMount",value:function(){var e=this,n=this.props.createOrEditAlbumDialog,t=n.isEditMode,i=n.editMetaInfo;if(i){var a=i.title,r=i.filenamelist,o=i.filedescmap,l=i.albumphotomap;this.setState({title:a||""},function(){t&&r&&o&&l&&e.checkAlbumQueue(r,o,l)})}}},{key:"closeDialog",value:function(){this.props.collectionActions.closeCreateOrEditAlbumDialog()}},{key:"createSubmit",value:function(){var e=this,n=this.state,t=n.title,i=n.isTitleEmpty,a=this.props.createOrEditAlbumDialog.itemuid,r=this.getAlbumQueue(a);if(r){var o=!t;o!==i&&this.setState({isTitleEmpty:o}),o||(r.isFinishAlbumUpload?(this.closeDialog(),r.removeAlbumQueue(r.itemuid)):r.isAllUploadSuccess?r.finish().then(function(n){e.closeDialog(),r.removeAlbumQueue(r.itemuid)}):this.backendUploadAlbumQueue(r))}}},{key:"createCancel",value:function(){var e=this.props.createOrEditAlbumDialog.itemuid,n=this.getAlbumQueue(e);n&&n.cancel(),this.closeDialog()}},{key:"editSubmit",value:function(){var e=this,n=this.state,t=n.title,i=n.isTitleEmpty,a=this.props.createOrEditAlbumDialog.itemuid,r=this.getAlbumQueue(a);if(r){var o=!t;if(o!==i&&this.setState({isTitleEmpty:o}),!o){var l=r.getTotal();r.isFinishAlbumUpload?(this.closeDialog(),r.removeAlbumQueue(r.itemuid)):l<=0||r.isAllUploadSuccess?r.finish().then(function(n){e.closeDialog(),r.removeAlbumQueue(r.itemuid)}):this.backendUploadAlbumQueue(r)}}}},{key:"editCancel",value:function(){this.closeDialog()}},{key:"backendUploadAlbumQueue",value:function(e){var n=this,t=this.props.createOrEditAlbumDialog.itemUpdateCallback;e.autoFinish=!0,this.updateAlbumQueue(e,function(){n.props.uploaderActions.addUploadQueue(e);for(var i,a,r=[],o=e.imagesMap,l=0;l<e.imageidList.length;l++)i=e.imageidList[l],a=o[i],r.push(a.filename);t&&t(e.itemuid,e.title,r),n.closeDialog()})}},{key:"onInputChange",value:function(e,n){var t=this;e.preventDefault();var i=e.target.value;this.setState(a({},n,i),function(){var e=t.props.createOrEditAlbumDialog.itemuid,a=t.getAlbumQueue(e);a&&(a[n]=i,a.updateAlbumQueue(a))})}},{key:"onImageInputChange",value:function(e,n){e.preventDefault();var t=this.props.createOrEditAlbumDialog.itemuid,i=this.getAlbumQueue(t);if(i){var a=e.target.value,r=i.imagesMap,o=r[n];o&&(o.description=a,i.updateAlbumQueue(i))}}},{key:"onFileDrop",value:function(e){Array.isArray(e)&&e.length>0&&this.startUploadAlbumCumatrixItem(e)}},{key:"onFileChanged",value:function(e){if(e&&e.target){var n=e.target.files;n&&n.length>0&&this.startUploadAlbumCumatrixItem(n)}}},{key:"startUploadAlbumCumatrixItem",value:function(e){var n=this.props.createOrEditAlbumDialog,t=n.itemuid;if(!this.getAlbumQueue(t))return void this.createAlbumCumatrixItem(e);this.addFilesToQueue(e)}},{key:"createAlbumCumatrixItem",value:function(e){var n=this;if(!this.isCreating){this.isCreating=!0;var t=this.state.title,i=this.props.createOrEditAlbumDialog,a=i.cumatrixUID,r=i.chaptertype,o=i.chaptername,l=i.isAddToFirst,u=i.itemCreateCallback;this.props.collectionActions.createAlbumItem({cumatrixid:a,chaptertype:r,chaptername:o,isAddToFirst:l,title:t}).then(function(t){n.isCreating=!1,t?n.props.collectionActions.updateCreateOrEditAlbumDialog({itemuid:t.itemuid}).then(function(){u&&u(t),n.createNewAlbumQueue(function(){n.addFilesToQueue(e)})}):n.setState({isCreateError:!0})},function(e){n.isCreating=!1,n.setState({isCreateError:!0})})}}},{key:"createNewAlbumQueue",value:function(e){var n=this.state.title,t=this.props,i=t.createOrEditAlbumDialog,r=t.collectionActions,o=i.itemuid,l=i.cumatrixUID,u=i.chaptertype,s=i.chaptername,c=i.itemCreateCallback,p=i.itemUpdateCallback,d=i.itemRemoveCallback,m=r.uploadCumatrixAlbumFile,g=r.updateAlbumMeta,f=r.removeAlbumPhoto,h=r.updateAlbumPhotoDescript,b=r.replaceAlbumPhotoOrder,v=r.openCreateOrEditAlbumDialog,A=r.removeCumatrixItemFromDefaultChapter,y=r.removeCumatrixItemFromChapter,E=r.removeCumatrixDraftItem,k={title:n,cumatrixUID:l,chaptertype:u,chaptername:s,itemuid:o,ctype:x.a.ctypeToInt.CTYPE_ALBUM,imageidList:[],paddingidList:[],imagesMap:{},removeNameList:[],current:0,progress:0,isAllUploading:!1,isAllUploadSuccess:!1,isFinishAlbumUpload:!1,id:o,autoFinish:!1,isSuccess:!1,isError:!1,updateAlbumQueue:this.updateAlbumQueue,removeAlbumQueue:this.removeAlbumQueue};k.start=function(){var e=this;if(e&&!e.isAllUploading){0!==e.paddingidList.length&&(e=Object.assign({},e,{isAllUploading:!0,isAllUploadSuccess:!1,isFinishAlbumUpload:!1,isSuccess:!1,isError:!1,progress:0,current:0}),e.updateAlbumQueue(e,function(){e.upload(0)}))}},k.upload=function(e){var n=this;if(n){var t=n.paddingidList,i=n.imagesMap,r=t[e],o=i[r];if(!r||!o)return n=Object.assign({},n,{isAllUploadSuccess:!0,isAllUploading:!1}),void n.updateAlbumQueue(n,function(){n.autoFinish&&n.finish()});if(!o.isUploading){if(o.isUploadSuccess||!o.file)return void n.upload(++e);o=Object.assign({},o,{isUploading:!0,isPending:!1,progress:0}),i=Object.assign([],i,a({},r,o)),n=Object.assign({},n,{imagesMap:i,current:e}),n.updateAlbumQueue(n,function(){m({cumatrixid:n.cumatrixUID,itemid:n.itemuid,description:o.description,file:o.file,progressCallback:function(e){o=Object.assign({},o,{progress:e}),i=Object.assign([],i,a({},r,o)),n=Object.assign({},n,{imagesMap:i}),n.updateAlbumQueue(n)}}).then(function(l){o=Object.assign({},o,{progress:100,isUploadSuccess:!0,isUploading:!1,thumburl:l.url,filename:l.filename}),i=Object.assign([],i,a({},r,o)),n=Object.assign({},n,{imagesMap:i,progress:(e+1)/t.length*100}),n.updateAlbumQueue(n,function(){n.upload(++e)})},function(e){o=Object.assign({},o,{isUploadError:!0,isUploading:!1}),i=Object.assign([],i,a({},r,o)),n=Object.assign({},n,{imagesMap:i,isAllUploading:!1,isError:!0}),n.updateAlbumQueue(n)})})}}},k.finish=function(){var e=this;if(e){return new Promise(function(n,t){if(e.isFinishAlbumUpload)return void n(!0);e.finish_updateAlbumMeta(e),e=Object.assign({},e,{isFinishAlbumUpload:!0,isSuccess:!0}),e.updateAlbumQueue(e,function(){e.autoFinish&&e.removeAlbumQueue(e.itemuid)});for(var i,a,r=[],o=e.imagesMap,l=0;l<e.imageidList.length;l++)i=e.imageidList[l],a=o[i],r.push(a.filename);p&&p(e.itemuid,e.title,r),n(!0)})}},k.finish_updateAlbumMeta=function(e){g({cumatrixid:e.cumatrixUID,itemid:e.itemuid,title:e.title}).then(function(n){e.finish_removeAlbumPhotos(e)},function(n){e.finish_removeAlbumPhotos(e)})},k.finish_removeAlbumPhotos=function(e){e.removeNameList.length>0?f({cumatrixid:e.cumatrixUID,itemid:e.itemuid,filenames:e.removeNameList}).then(function(n){e.finish_updateAlbumPhotoDescript(e)},function(n){e.finish_updateAlbumPhotoDescript(e)}):e.finish_updateAlbumPhotoDescript(e)},k.finish_updateAlbumPhotoDescript=function(e){for(var n,t,i=[],a=[],r=e.imagesMap,o=0;o<e.imageidList.length;o++)n=e.imageidList[o],(t=r[n])&&t.orgDescription!==t.description&&(i.push(t.filename),a.push(t.description));i.length>0?h({cumatrixid:e.cumatrixUID,itemid:e.itemuid,filenames:i,descriptions:a}).then(function(n){k.finish_replaceAlbumPhotoOrder(e)},function(n){k.finish_replaceAlbumPhotoOrder(e)}):k.finish_replaceAlbumPhotoOrder(e)},k.finish_replaceAlbumPhotoOrder=function(e){for(var n,t,i=[],a=e.imagesMap,r=0;r<e.imageidList.length;r++)n=e.imageidList[r],t=a[n],i.push(t.filename);b({cumatrixid:e.cumatrixUID,itemid:e.itemuid,filenames:i})},k.retry=function(){console.log("retry");var e=this;if(e){var n={isError:!1,progress:0,isAllUploading:!1,isAllUploadSuccess:!1,isFinishAlbumUpload:!1};e=Object.assign({},e,n),e.updateAlbumQueue(e,function(){e.start()})}},k.cancel=function(){var e=this;if(e&&e.itemuid){switch(e.chaptertype){case x.a.chapterType.DEFAULTCHAPTER:A(e.cumatrixUID,e.itemuid);break;case x.a.chapterType.NORMALCHAPTER:y(l,e.itemuid,e.chaptername);break;case x.a.chapterType.DRAFT:E(l,e.itemuid)}d&&d(e.itemuid)}},k.edit=function(){var e=this;e&&(e.autoFinish=!1,e.updateAlbumQueue(e,function(){v({itemuid:e.itemuid,editMetaInfo:{title:e.title},cumatrixUID:e.cumatrixUID,chaptertype:e.chaptertype,chaptername:e.chaptername,isAddToFirst:e.isAddToFirst,itemCreateCallback:c,itemUpdateCallback:p,itemRemoveCallback:d})}))},k.getTotal=function(){var e=this;return e.paddingidList.length-e.removeNameList.length},this.updateAlbumQueue(k,e)}},{key:"addFilesToQueue",value:function(e){for(var n,t=this.props.createOrEditAlbumDialog,r=t.itemuid,o=this.getAlbumQueue(r),l=o.imageidList,u=o.paddingidList,s=o.imagesMap,c=Date.now(),p=0;p<e.length;p++)if(n=e[p],-1!==n.type.indexOf("image")){var d="pendding-"+c+p,m=b()(),g={imageid:m,filename:d,file:n,size:n.size,title:n.name,description:"",thumburl:window.URL.createObjectURL(n),progress:0,isPending:!0,isUploading:!1,isUploadSuccess:!1,isUploadError:!1};l=[].concat(i(l),[m]),u=[].concat(i(u),[m]),s=Object.assign({},s,a({},m,g))}o=Object.assign({},o,{imageidList:l,paddingidList:u,imagesMap:s}),o.updateAlbumQueue(o,function(){o.start()})}},{key:"getAlbumQueue",value:function(e){if(e){return this.props.createOrEditAlbumDialog.albumQueueMap[e]}}},{key:"updateAlbumQueue",value:function(e,n){var t=this.props.createOrEditAlbumDialog.albumQueueMap,i=Object.assign({},t,a({},e.itemuid,e));this.props.collectionActions.updateCreateOrEditAlbumDialog({albumQueueMap:i}).then(function(){n&&n()}),this.props.uploaderActions.uploadQueueState(e)}},{key:"removeAlbumQueue",value:function(e){var n=this.props.createOrEditAlbumDialog.albumQueueMap,t=Object.assign({},n,a({},e,void 0));this.props.collectionActions.updateCreateOrEditAlbumDialog({albumQueueMap:t})}},{key:"getAlbumImage",value:function(e){return e&&e.thumburl?e.thumburl:"about:blank"}},{key:"removeImage",value:function(e){var n=this.props.createOrEditAlbumDialog,t=n.itemuid,a=this.getAlbumQueue(t),r=a.imageidList,o=a.removeNameList,l=a.imagesMap,u=l[e];if(u){o.push(u.filename);for(var s=0;s<r.length;s++)if(e===r[s]){r=[].concat(i(r.slice(0,s)),i(r.slice(s+1)));break}a.imageidList=r,a.removeNameList=o,this.updateAlbumQueue(a)}}},{key:"checkAlbumQueue",value:function(e,n,t){var i=this,a=this.props.createOrEditAlbumDialog.itemuid;this.getAlbumQueue(a)||this.createNewAlbumQueue(function(){i.addEditImageToQueue(e,n,t)})}},{key:"addEditImageToQueue",value:function(e,n,t){if(Array.isArray(e)&&0!==e.length){for(var r,o=this.props.createOrEditAlbumDialog,l=o.itemuid,u=this.getAlbumQueue(l),s=u.imageidList,c=u.imagesMap,p=0;p<e.length;p++){r=e[p];var d=b()(),m={imageid:d,filename:r,title:r,description:n[r]||"",thumburl:t[r]||""};s=[].concat(i(s),[d]),c=Object.assign({},c,a({},d,m))}u=Object.assign({},u,{imageidList:s,imagesMap:c}),u.updateAlbumQueue(u)}}},{key:"renderContent",value:function(){var e=this.props.createOrEditAlbumDialog.itemuid,n=this.getAlbumQueue(e);return n&&0!==n.imageidList.length?this.renderAlbumContent(n):this.renderEmptyContent()}},{key:"renderEmptyContent",value:function(){var e=this;return c.a.createElement(ee,{empty:!0},c.a.createElement(ne,{accept:"image/*",multiple:!0,onDrop:function(n){return e.onFileDrop(n)},acceptStyle:{backgroundColor:v.e.RGBA(v.e.Blue,.1)},rejectStyle:{backgroundColor:v.e.RGBA(v.e.Red,.1)}},c.a.createElement(te,null,c.a.createElement(ie,{src:"images/image-files.png",alt:"image-files"}),c.a.createElement(ae,null,c.a.createElement(A.a,null,"\u62d6\u66f3\u5716\u7247\u4e0a\u50b3")),c.a.createElement(re,null,c.a.createElement(A.a,null,"\u6216\u8005\u4f60\u4e5f\u53ef\u4ee5",c.a.createElement(oe,null,"\u5f9e\u96fb\u8166\u9078\u64c7\u6a94\u6848"))))))}},{key:"renderAlbumContent",value:function(e){var n=this,t=e.imageidList,i=e.imagesMap;return c.a.createElement(ee,null,c.a.createElement(le,{accept:"image/*",multiple:!0,onDrop:function(e){return n.onFileDrop(e)},acceptStyle:{backgroundColor:v.e.RGBA(v.e.Blue,.1)},rejectStyle:{backgroundColor:v.e.RGBA(v.e.Red,.1)},disableClick:!0},c.a.createElement(ue,null,c.a.createElement(se,null,c.a.createElement("i",{className:"zmdi zmdi-plus"})),c.a.createElement("input",{type:"file",name:"file",accept:"image/*",onChange:function(e){return n.onFileChanged(e)}})),t.map(function(e,t){var a=i[e];return a?n.renderImageContent(a):null})))}},{key:"renderImageContent",value:function(e){var n=this,t=0;e.isUploading||e.isPending?t=e.progress:e.isUploadSuccess&&(t=100);var i=e.imageid;return c.a.createElement(pe,{key:i},c.a.createElement(de,null,c.a.createElement(y.a,{src:this.getAlbumImage(e),stylecomponent:me,isBackgroundImage:!0}),e.isUploadError?c.a.createElement(ge,null,c.a.createElement(fe,{error:!0},c.a.createElement(he,null,c.a.createElement("i",{className:"zmdi zmdi-alert-circle"})),c.a.createElement(A.a,null,"\u4e0a\u50b3\u5931\u6557"))):null,e.isUploadError||!e.isUploading&&!e.isPending?null:c.a.createElement(ge,null,e.isPending?c.a.createElement(fe,null,c.a.createElement(A.a,null,"\u7b49\u5f85\u4e0a\u50b3")):null,e.isUploading&&e.progress<100?c.a.createElement(fe,null,c.a.createElement(A.a,null,"\u6b63\u5728\u4e0a\u50b3...")," ",e.progress,"%"):null,e.isUploading&&100===e.progress?c.a.createElement(fe,null,c.a.createElement(A.a,null,"\u6a94\u6848\u8655\u7406\u4e2d...")):null,c.a.createElement(be,null,c.a.createElement(xe,{progress:t})))),c.a.createElement(ve,null,c.a.createElement(Ae,{type:"text",value:e.description,placeholder:"\u7528\u5e7e\u53e5\u8a71\u8aaa\u660e\u9019\u5f35\u5716\u7247...",onChange:function(e){return n.onImageInputChange(e,i)}})),c.a.createElement(ce,{onClick:function(){return n.removeImage(i)}},c.a.createElement("i",{className:"zmdi zmdi-close"})))}},{key:"render",value:function(){var e=this,n=this.state,t=n.title,i=n.isTitleEmpty,a=this.props.createOrEditAlbumDialog.isEditMode;return c.a.createElement(v.f.Content,{width:"90%",maxWidth:"1260px",height:"calc(100% - 40px)",padding:"0",backgroundColor:"#fff",innerFullHeight:!0,visible:!0,animation:"zoom",maskAnimation:"fade",closable:!1,maskClosable:!1,keyboard:!1,onClose:this.closeDialog},c.a.createElement(J,null,c.a.createElement(W,{type:"text",value:t,onChange:function(n){return e.onInputChange(n,"title")},placeholder:"\u8f38\u5165\u76f8\u7c3f\u540d\u7a31",error:i}),a?c.a.createElement(K,null,c.a.createElement($,{onClick:this.editCancel},c.a.createElement(A.a,null,"\u53d6\u6d88")),c.a.createElement(Z,{onClick:this.editSubmit},c.a.createElement(A.a,null,"\u66f4\u65b0\u76f8\u7c3f"))):c.a.createElement(K,null,c.a.createElement($,{onClick:this.createCancel},c.a.createElement(A.a,null,"\u53d6\u6d88")),c.a.createElement(Z,{onClick:this.createSubmit},c.a.createElement(A.a,null,"\u5efa\u7acb\u76f8\u7c3f")))),this.renderContent())}}]),n}(s.Component),Ee=function(e){return{createOrEditAlbumDialog:e.collection.createOrEditAlbumDialog}},ke=function(e){return{uploaderActions:Object(p.bindActionCreators)(m.a.uploaderActionCreators,e),collectionActions:Object(p.bindActionCreators)(m.a.collectionActionCreators,e)}};n.default=Object(d.b)(Ee,ke,null,{withRef:!0})(ye)}});
//# sourceMappingURL=30.96146e77.chunk.js.map